{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///D:/linkedin%20content%20generator/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma = globalForPrisma.prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 83, "column": 0}, "map": {"version":3,"sources":["file:///D:/linkedin%20content%20generator/app/api/analyze-hook/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { GoogleGenerativeAI } from '@google/generative-ai';\r\nimport { auth, currentUser } from '@clerk/nextjs/server';\r\nimport { prisma } from '@/lib/prisma';\r\n\r\nconst genAI = new GoogleGenerativeAI(process.env.GOOGLE_GENERATIVE_AI_API_KEY || '');\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const apiKey = process.env.GOOGLE_GENERATIVE_AI_API_KEY;\r\n        if (!apiKey) {\r\n            console.error(\"GOOGLE_GENERATIVE_AI_API_KEY is missing\");\r\n            return NextResponse.json(\r\n                { error: 'Server configuration error: API key missing' },\r\n                { status: 500 }\r\n            );\r\n        }\r\n\r\n        const { hook } = await request.json();\r\n        const { userId } = await auth();\r\n\r\n        if (!hook) {\r\n            return NextResponse.json({ error: 'Hook text is required' }, { status: 400 });\r\n        }\r\n\r\n        if (userId) {\r\n            const dbUser = await prisma.user.findUnique({ where: { id: userId } });\r\n            if (dbUser) {\r\n                const ONE_DAY = 24 * 60 * 60 * 1000;\r\n                const daysSinceCreation = Math.floor((Date.now() - new Date(dbUser.createdAt).getTime()) / ONE_DAY);\r\n                const isTrialActive = daysSinceCreation < 14;\r\n                const isPro = dbUser.plan === 'PRO' || dbUser.plan === 'BUSINESS';\r\n\r\n                if (!isTrialActive && !isPro) {\r\n                    return NextResponse.json(\r\n                        { error: 'Viral Hook Engine is a Pro feature. Please upgrade.' },\r\n                        { status: 403 }\r\n                    );\r\n                }\r\n            }\r\n        }\r\n\r\n        const model = genAI.getGenerativeModel({ model: \"gemini-flash-latest\" });\r\n\r\n        const prompt = `Analyze this LinkedIn post opening line (hook): \"${hook}\"\r\n\r\n    Return a JSON object with the following structure (do not include markdown formatting):\r\n    {\r\n      \"score\": number (1-10),\r\n      \"color\": \"green\" | \"yellow\" | \"red\",\r\n      \"badges\": [\"string (e.g., Curiosity gap detected, Emotional trigger present, Question fatigue warning, Generic opening detected)\"],\r\n      \"feedback\": \"string (Why this score?)\",\r\n      \"alternatives\": [\"string (Alternative hook 1)\", \"string (Alternative hook 2)\", \"string (Alternative hook 3)\"]\r\n    }\r\n\r\n    Scoring criteria:\r\n    - 8-10 (Green): High curiosity, strong emotion, or specific benefit.\r\n    - 5-7 (Yellow): Good but could be sharper.\r\n    - 1-4 (Red): Generic, boring, or too long.`;\r\n\r\n        const result = await model.generateContent(prompt);\r\n        const response = await result.response;\r\n        let text = response.text();\r\n\r\n        // Clean up markdown code blocks if present (handle ```json and ```)\r\n        text = text.replace(/```(?:json)?/g, '').replace(/```/g, '').trim();\r\n\r\n        let analysis;\r\n        try {\r\n            analysis = JSON.parse(text);\r\n        } catch (e) {\r\n            console.error(\"Failed to parse LLM response:\", text);\r\n            return NextResponse.json(\r\n                { error: 'Failed to parse AI response. Please try again.' },\r\n                { status: 500 }\r\n            );\r\n        }\r\n\r\n        // Save to DB if logged in\r\n        if (userId) {\r\n            try {\r\n                // Ensure user exists in DB first (upsert)\r\n                await prisma.user.upsert({\r\n                    where: { id: userId },\r\n                    update: {},\r\n                    create: { id: userId, email: (await currentUser())?.emailAddresses[0]?.emailAddress || 'unknown' },\r\n                });\r\n\r\n                await prisma.hookAnalysis.create({\r\n                    data: {\r\n                        hookText: hook,\r\n                        score: analysis.score,\r\n                        feedback: JSON.stringify(analysis),\r\n                        userId: userId,\r\n                    },\r\n                });\r\n            } catch (dbError) {\r\n                console.error(\"Database error saving analysis:\", dbError);\r\n                // Don't fail the request if saving to DB fails, just log it\r\n            }\r\n        }\r\n\r\n        return NextResponse.json(analysis);\r\n    } catch (error: any) {\r\n        console.error(\"Hook analysis error:\", error);\r\n        return NextResponse.json(\r\n            { error: error instanceof Error ? error.message : 'Failed to analyze hook' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AAAA;AACA;;;;;AAEA,MAAM,QAAQ,IAAI,sLAAkB,CAAC,+EAA4C;AAE1E,eAAe,KAAK,OAAgB;IACvC,IAAI;QACA,MAAM;QACN;;QAQA,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,IAAI;QACnC,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAA,6LAAI;QAE7B,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwB,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,IAAI,QAAQ;YACR,MAAM,SAAS,MAAM,yHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;gBAAE,OAAO;oBAAE,IAAI;gBAAO;YAAE;YACpE,IAAI,QAAQ;gBACR,MAAM,UAAU,KAAK,KAAK,KAAK;gBAC/B,MAAM,oBAAoB,KAAK,KAAK,CAAC,CAAC,KAAK,GAAG,KAAK,IAAI,KAAK,OAAO,SAAS,EAAE,OAAO,EAAE,IAAI;gBAC3F,MAAM,gBAAgB,oBAAoB;gBAC1C,MAAM,QAAQ,OAAO,IAAI,KAAK,SAAS,OAAO,IAAI,KAAK;gBAEvD,IAAI,CAAC,iBAAiB,CAAC,OAAO;oBAC1B,OAAO,gJAAY,CAAC,IAAI,CACpB;wBAAE,OAAO;oBAAsD,GAC/D;wBAAE,QAAQ;oBAAI;gBAEtB;YACJ;QACJ;QAEA,MAAM,QAAQ,MAAM,kBAAkB,CAAC;YAAE,OAAO;QAAsB;QAEtE,MAAM,SAAS,CAAC,iDAAiD,EAAE,KAAK;;;;;;;;;;;;;;8CAclC,CAAC;QAEvC,MAAM,SAAS,MAAM,MAAM,eAAe,CAAC;QAC3C,MAAM,WAAW,MAAM,OAAO,QAAQ;QACtC,IAAI,OAAO,SAAS,IAAI;QAExB,oEAAoE;QACpE,OAAO,KAAK,OAAO,CAAC,iBAAiB,IAAI,OAAO,CAAC,QAAQ,IAAI,IAAI;QAEjE,IAAI;QACJ,IAAI;YACA,WAAW,KAAK,KAAK,CAAC;QAC1B,EAAE,OAAO,GAAG;YACR,QAAQ,KAAK,CAAC,iCAAiC;YAC/C,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAiD,GAC1D;gBAAE,QAAQ;YAAI;QAEtB;QAEA,0BAA0B;QAC1B,IAAI,QAAQ;YACR,IAAI;gBACA,0CAA0C;gBAC1C,MAAM,yHAAM,CAAC,IAAI,CAAC,MAAM,CAAC;oBACrB,OAAO;wBAAE,IAAI;oBAAO;oBACpB,QAAQ,CAAC;oBACT,QAAQ;wBAAE,IAAI;wBAAQ,OAAO,CAAC,MAAM,IAAA,2MAAW,GAAE,GAAG,cAAc,CAAC,EAAE,EAAE,gBAAgB;oBAAU;gBACrG;gBAEA,MAAM,yHAAM,CAAC,YAAY,CAAC,MAAM,CAAC;oBAC7B,MAAM;wBACF,UAAU;wBACV,OAAO,SAAS,KAAK;wBACrB,UAAU,KAAK,SAAS,CAAC;wBACzB,QAAQ;oBACZ;gBACJ;YACJ,EAAE,OAAO,SAAS;gBACd,QAAQ,KAAK,CAAC,mCAAmC;YACjD,4DAA4D;YAChE;QACJ;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAAyB,GAC3E;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}